{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto py-32 text-center">
    <!-- Animated AI Core -->
    <div class="relative w-48 h-48 mx-auto mb-12">
        <div class="absolute inset-0 bg-brand-500/20 rounded-full animate-ping"></div>
        <div class="absolute inset-4 bg-brand-500/40 rounded-full animate-pulse"></div>
        <div
            class="relative z-10 w-full h-full glass rounded-full flex items-center justify-center shadow-2xl border-brand-200 dark:border-slate-700">
            <svg class="w-16 h-16 text-brand-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                </path>
            </svg>
        </div>
    </div>

    <h1 class="text-3xl font-extrabold mb-4">Analyzing Financial Patterns</h1>
    <p class="text-slate-500 dark:text-slate-400 mb-8" id="loading-step">Connecting to OpenAI categorization engine...
    </p>

    <div class="w-full bg-gray-200 dark:bg-slate-800 rounded-full h-2 mb-12">
        <div id="progress-bar" class="bg-brand-600 h-2 rounded-full transition-all duration-500" style="width: 10%">
        </div>
    </div>

    <div class="space-y-3">
        <div class="flex items-center gap-3 text-sm text-slate-400" id="step-1">
            <div class="w-4 h-4 rounded-full bg-brand-500 flex items-center justify-center text-[8px] text-white">✓
            </div>
            <span>CSV Parsing Complete</span>
        </div>
        <div class="flex items-center gap-3 text-sm" id="step-2">
            <div
                class="w-4 h-4 rounded-full border-2 border-slate-300 dark:border-slate-700 flex items-center justify-center text-[8px] text-white">
            </div>
            <span class="text-slate-600 dark:text-slate-400">AI Category Mapping</span>
        </div>
        <div class="flex items-center gap-3 text-sm text-slate-300 dark:text-slate-600" id="step-3">
            <div
                class="w-4 h-4 rounded-full border-2 border-slate-200 dark:border-slate-800 flex items-center justify-center text-[8px] text-white">
            </div>
            <span>Risk Coefficient Calculation</span>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const steps = [
        "Analyzing transaction descriptions with OpenAI...",
        "Identifying essential vs discretionary spending...",
        "Calculating Net Savings Rate...",
        "Applying fintech-grade risk formulas...",
        "Finalizing your professional dashboard..."
    ];
    let currentStep = 0;
    const reportId = "{{ report_id }}";

    function updateProgress() {
        if (currentStep < steps.length) {
            document.getElementById('loading-step').innerText = steps[currentStep];
            document.getElementById('progress-bar').style.width = (20 + (currentStep * 20)) + "%";

            if (currentStep === 1) {
                document.getElementById('step-2').classList.add('text-brand-600');
                document.getElementById('step-2').children[0].classList.add('bg-brand-500', 'border-brand-500');
                document.getElementById('step-2').children[0].innerText = '✓';
            }
            if (currentStep === 3) {
                document.getElementById('step-3').classList.add('text-brand-600');
                document.getElementById('step-3').children[0].classList.add('bg-brand-500', 'border-brand-500');
                document.getElementById('step-3').children[0].innerText = '✓';
            }

            currentStep++;
            setTimeout(updateProgress, 1500);
        } else {
            window.location.href = `/report-page/${reportId}`;
        }
    }

    setTimeout(updateProgress, 1000);
</script>
{% endblock %}